# 实时跨镜头人物追踪使用说明

## 功能说明

这个功能可以：
1. **实时监控多个摄像头**（从Dashboard加载）
2. **选择要追踪的目标人物**
3. **自动告警**：当在任何摄像头中发现目标时，立即提醒你

## 使用步骤

### 第1步：在Dashboard添加视频源

1. 回到 **"Dashboard"** 页面
2. 你应该已经看到了2个视频源：
   - Source 735f2eda (人群监控)
   - Source 8e204f39 (室内监控)

### 第2步：打开实时追踪

1. 点击顶部的 **"Cross-Camera Tracking"** 标签
2. 页面会自动加载Dashboard中的所有视频源
3. 每个摄像头会显示在网格中

### 第3步：选择追踪目标

1. 点击 **"选择追踪目标"** 按钮（绿色）
2. 会打开目标选择对话框，显示第一个摄像头的画面
3. **浏览视频找到要追踪的人**：
   - 使用滑块快速跳转
   - 或点击"上一帧/下一帧"按钮
4. **点击画面中的人物**（绿色框内任意位置）
5. 选中后会显示黄色高亮和"SELECTED"标记
6. 点击 **"确认选择"**

### 第4步：开始监控

1. 目标预览会显示选中的人物图片
2. 点击 **"开始监控"** 按钮（蓝色）
3. **所有摄像头开始实时监控**！

### 第5步：查看告警

当系统在任何摄像头中发现目标人物时：

#### 自动告警：
- ⚠️ **弹出警告框**："发现目标 - Camera名称"
- 🔴 **摄像头画面变红色边框**（5秒后自动恢复）
- 📹 **目标用红色框高亮**，显示"TARGET FOUND!"
- 📝 **告警记录列表**自动添加记录

#### 告警信息包含：
- 时间戳：[14:23:45]
- 摄像头名称：Source 8e204f39
- 相似度：85%

## 界面说明

```
┌─────────────────────────────────────────────────────┐
│  实时跨镜头追踪                                        │
│  [选择追踪目标] [开始监控] [停止监控]                   │
├─────────────────────────────────────────────────────┤
│ 追踪目标: [图片] │ 告警记录:                           │
│                  │ [14:23:45] Camera 2 - 85%       │
│                  │ [14:22:10] Camera 1 - 78%       │
├──────────────────┴─────────────────────────────────┤
│                                                     │
│  ┌────────────────┐    ┌────────────────┐         │
│  │ 📹 Camera 1    │    │ 📹 Camera 2    │         │
│  │ [实时画面]      │    │ [实时画面]      │         │
│  │ 正常监控        │    │ ⚠️ 发现目标！   │  (红框)│
│  └────────────────┘    └────────────────┘         │
│                                                     │
│  ┌────────────────┐    ┌────────────────┐         │
│  │ 📹 Camera 3    │    │ 📹 Camera 4    │         │
│  │ [实时画面]      │    │ [实时画面]      │         │
│  │ 正常监控        │    │ 正常监控        │         │
│  └────────────────┘    └────────────────┘         │
└─────────────────────────────────────────────────────┘
```

## 按钮说明

### 🟢 选择追踪目标
- 从第一个摄像头选择要追踪的人物
- 只能在监控停止时使用

### 🔵 开始监控
- 启动实时监控所有摄像头
- 需要先选择追踪目标

### 🔴 停止监控
- 停止所有摄像头监控
- 清除所有告警高亮

## 工作原理

```
1. 提取目标特征
   ↓
2. 每个摄像头独立运行监控线程
   ↓
3. 实时检测每一帧中的所有人
   ↓
4. 提取每个人的特征
   ↓
5. 与目标特征比对（余弦相似度）
   ↓
6. 相似度 > 50% → 触发告警！
```

## 性能说明

- **帧率**：每个摄像头约30 FPS
- **延迟**：检测到目标后立即告警（< 1秒）
- **资源占用**：
  - 2个摄像头：流畅运行
  - 4个摄像头：需要较好的CPU/GPU
  - 6+摄像头：建议使用GPU

## 参数调整

### 相似度阈值（代码中调整）

打开 `src/ui/live_tracking_page.py`，找到第312行：

```python
thread.set_target(self.target_feature, threshold=0.5)
```

**调整建议**：
- `0.3-0.4`：宽松匹配，更多告警（可能误报）
- `0.5`：平衡（默认）
- `0.6-0.7`：严格匹配，减少误报

## 常见问题

### Q1: 没有看到任何摄像头？

**原因**：Dashboard中没有视频源

**解决**：
1. 回到Dashboard
2. 添加视频源
3. 重新打开Cross-Camera Tracking页面

### Q2: 告警太频繁怎么办？

**解决**：
1. 提高相似度阈值到0.6-0.7
2. 选择穿着更独特的目标
3. 添加告警间隔（防止重复告警）

### Q3: 从不告警？

**原因**：
- 阈值太高
- 目标不在其他摄像头中
- 目标外观变化太大

**解决**：
1. 降低阈值到0.3-0.4
2. 确认目标确实在视频中出现
3. 选择更清晰的目标

### Q4: 画面卡顿？

**原因**：摄像头太多，CPU/GPU性能不足

**解决**：
1. 减少同时监控的摄像头数量
2. 降低视频分辨率
3. 使用GPU加速

## 实际应用场景

### 场景1：商场安防
- 在入口摄像头选择可疑人员
- 追踪其在商场内的移动路径
- 实时告警在哪个区域出现

### 场景2：小区监控
- 选择陌生访客
- 监控其在小区内的活动
- 自动记录出现时间和位置

### 场景3：工厂/办公楼
- 追踪特定员工
- 监控工作区域移动
- 考勤和路径分析

## 告警记录说明

告警列表显示最近50条记录：
- 最新的在最上面
- 显示时间、摄像头、相似度
- 可以滚动查看历史记录

## 提示

1. **选择目标技巧**：
   - 选择穿着颜色鲜艳的人
   - 避免选择被遮挡的人
   - 选择正面或侧面清晰的人

2. **减少误报**：
   - 提高相似度阈值
   - 选择穿着独特的目标

3. **提高检测率**：
   - 降低相似度阈值
   - 确保摄像头画质良好

## 与离线搜索的区别

| 功能 | 实时追踪 | 离线搜索 |
|------|---------|---------|
| 模式 | 实时监控 | 事后搜索 |
| 速度 | 立即告警 | 需要等待扫描完成 |
| 用途 | 监控当前活动 | 查找历史记录 |
| 告警 | 弹窗+高亮 | 列表显示 |

## 下一步改进

计划中的功能：
1. 告警声音提示
2. 告警截图保存
3. 移动路径追踪
4. 多目标同时追踪
5. 告警间隔控制

---

现在你有了一个完整的**实时跨镜头追踪系统**！
