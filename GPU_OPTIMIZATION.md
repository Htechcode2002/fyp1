# GPU 优化日志

## 优化日期: 2026-01-08

### 📊 优化总结

以下优化在**不明显影响检测精度**的前提下，预计可以**减少约 30-40% 的 GPU 负载**：

---

### 1️⃣ InsightFace 人脸分析 (`face_analyzer.py`)
- **更改**: `det_size` 从 `(640, 640)` → `(480, 480)`
- **效果**: 减少约 44% 的像素处理量
- **影响**: 对中远距离人脸检测精度有轻微影响，近距离无影响

### 2️⃣ 跌倒检测 (`detection.py`)
- **更改**: 添加 `half=True` (FP16) 和 `imgsz=480`
- **效果**: 减少约 50% 显存使用，推理速度提升约 30%
- **影响**: 精度损失可忽略不计

### 3️⃣ Pose 姿态估计 (`detection.py`)
- **更改**: 添加 `imgsz=480`
- **效果**: 减少约 44% 的计算量
- **影响**: 关键点检测精度略有下降，但对于颜色区域定位足够

### 4️⃣ 口罩检测 (`detection.py`)
- **更改**: 添加 `imgsz=480`
- **效果**: 减少约 44% 的计算量
- **影响**: 检测精度略有下降，但实际使用中影响极小

### 5️⃣ 人脸分析频率 (`detection.py`)
- **更改**: `face_analysis_freq` 从 `30` → `45` 帧
- **效果**: 减少 33% 的人脸分析调用
- **影响**: 无影响，因为有 1-confirmation 缓存机制

### 6️⃣ GPU 内存清理 (`detection.py`)
- **更改**: 清理频率从 `500` → `300` 帧
- **效果**: 更频繁地释放未使用的 GPU 内存，防止内存泄露
- **影响**: 无负面影响

---

## 📈 预期性能提升

| 指标 | 优化前 | 优化后 | 提升 |
|------|--------|--------|------|
| GPU 显存使用 | ~6-8 GB | ~4-6 GB | ~25-30% |
| 推理延迟 | 较高 | 较低 | ~20-30% |
| 帧率 (FPS) | ~15-20 | ~20-25 | ~25% |

---

## ⚠️ 注意事项

1. **主YOLO检测**保持 640x640 不变，这是最关键的检测，需要保证精度
2. 所有辅助检测（口罩、跌倒、姿态）使用 480x480，因为它们依赖于主检测的结果
3. 如果发现检测精度明显下降，可以将 `imgsz=480` 改回 `imgsz=640`

---

## 🔧 进一步优化建议（可选）

如果仍需要更低的 GPU 负载，可以考虑：

1. **切换到更轻量的 YOLO 模型**:
   - `yolov8m.pt` → `yolov8n.pt` (约快 3 倍)
   - `yolo12m.pt` → `yolo12n.pt`

2. **增加主检测跳帧**:
   - 将 `inference_freq` 从 `1` 改为 `2` (每 2 帧处理 1 帧)

3. **禁用不需要的功能**:
   - 关闭跌倒检测 / 口罩检测 / 人脸分析
